<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 도서함</title>
    <link rel="stylesheet" href="my_library.css">
    <link rel="stylesheet" href="https://webfontworld.github.io/NanumSquare/NanumSquare.css">
    <!-- Font Awesome 아이콘 사용 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<!-- 헤더 섹션 -->
<header>
    <a href="main"><h1>일기 속 도서관</h1></a>
    <nav>
        <ul>
            <li><a href="recommend">도서 추천</a></li>
            <li><a href="my_library">도서함</a></li>
            <li><a href="mypage">내 정보</a></li>
        </ul>
        <p th:text="'name: ' + ${name} "></p>
        <p th:text="'username: ' + ${username} "></p>
        <!--        <button type="button" class="login-button" onClick="location.href='login.html'">로그인</button>-->
    </nav>
</header>

<h1>my_library 도서함 페이지</h1>

<!-- 날짜 선택 섹션 -->
<div class="date-picker-container">
    <label for="diary-date">날짜 선택:</label>
    <input type="date" id="diary-date" name="diary-date">
    <button type="button" class="search-button" id="search-button">
        검색
    </button>
</div>

<!-- 일기 결과 출력 영역 -->
<div id="diary-result"></div>

<script>
    document.getElementById("search-button").addEventListener("click", function () {
        const selectedDate = document.getElementById("diary-date").value;

        // 날짜 선택 여부 체크
        if (!selectedDate) {
            alert("날짜를 선택해주세요.");
            return;
        }

        // 서버에서 일기 데이터를 가져오기
        fetch(`/my_library/api?date=${selectedDate}`)
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById("diary-result");
                resultDiv.innerHTML = ""; // 기존 결과 초기화

                // data가 배열인지 확인
                if (!Array.isArray(data)) {
                    resultDiv.innerHTML = "<p>일기 데이터 형식에 문제가 있습니다.</p>";
                    return;
                }

                // 데이터가 없을 때 처리
                if (data.length === 0) {
                    resultDiv.innerHTML = "<p>일기가 없습니다.</p>";
                } else {
                    // 데이터를 화면에 표시
                    data.forEach(diary => {
                        // 다이어리 내용 표시
                        const diaryElement = document.createElement("div"); // div로 그룹화
                        diaryElement.style.marginBottom = "20px";

                        const contentElement = document.createElement("p");
                        contentElement.textContent = `내용: ${diary.content}, 작성일: ${diary.createdDate}`;
                        diaryElement.appendChild(contentElement);

                        // 이미지 추가
                        const imageElement = document.createElement("img");
                        imageElement.src = diary.imageUrl; // diary의 imageUrl 사용
                        imageElement.alt = "Diary Image";
                        imageElement.style.maxWidth = "300px"; // 이미지 크기 조절
                        imageElement.style.display = "block"; // 줄 바꿈
                        diaryElement.appendChild(imageElement);

                        // 책 정보 표시
                        if (diary.book) {
                            const bookElement = document.createElement("p");
                            bookElement.textContent = `책 제목: ${diary.book.title}, 저자: ${diary.book.author}`;
                            diaryElement.appendChild(bookElement);

                            // 책 이미지 표시
                            if (diary.book.bookImage) {
                                const bookImageElement = document.createElement("img");
                                bookImageElement.src = diary.book.bookImage; // book의 bookImage 사용
                                bookImageElement.alt = "Book Image";
                                bookImageElement.style.maxWidth = "100px"; // 책 이미지 크기 조절
                                bookImageElement.style.display = "block"; // 줄 바꿈
                                diaryElement.appendChild(bookImageElement);
                            }

                            // 책 링크 추가
                            if (diary.book.bookLink) {
                                const bookLinkElement = document.createElement("a");
                                bookLinkElement.href = diary.book.bookLink;
                                bookLinkElement.textContent = "책 상세 보기";
                                bookLinkElement.target = "_blank"; // 새 탭에서 열기
                                bookLinkElement.style.display = "block"; // 줄 바꿈
                                bookLinkElement.style.marginTop = "10px"; // 여백 추가
                                diaryElement.appendChild(bookLinkElement);
                            }

                            // 책 요약 추가
                            if (diary.book.summary) {
                                const summaryElement = document.createElement("p");
                                summaryElement.textContent = `요약: ${diary.book.summary}`;
                                diaryElement.appendChild(summaryElement);
                            }
                        }

                        resultDiv.appendChild(diaryElement);
                    });
                }

            })
            .catch(error => {
                console.error("Error fetching diary:", error);
                const resultDiv = document.getElementById("diary-result");
                resultDiv.innerHTML = "<p>일기를 가져오는 중에 오류가 발생했습니다.</p>";
            });
    });
</script>

</body>
</html>
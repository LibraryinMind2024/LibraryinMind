<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ë„ì„œí•¨</title>
    <link rel="stylesheet" href="css/my_library.css">
    <link rel="stylesheet" href="css/my_library_rp.css">

    <link rel="stylesheet" href="https://webfontworld.github.io/NanumSquare/NanumSquare.css">
    <!-- Font Awesome ì•„ì´ì½˜ ì‚¬ìš© -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="icon" type="image/png" href="image/notebook_icon.png">
</head>
<body>
<!-- í—¤ë” ì„¹ì…˜ -->
<header>
    <img src="image/notebook_icon.png" alt="Notebook Icon">
    <a href="main"><h1>ì¼ê¸° ì† ë„ì„œê´€</h1></a>
    <nav>
        <ul>
            <li><a href="recommend">ë„ì„œ ì¶”ì²œ</a></li>
            <li><a href="my_library">ë„ì„œí•¨</a></li>
            <li><a href="mypage">ë‚´ ì •ë³´</a></li>
        </ul>

        <div th:if="${username != null}">
            <button type="button" class="login-button" onClick="location.href='/logout'">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        <div th:if="${username == null}">
            <button type="button" class="login-button" onClick="location.href='/login'">ë¡œê·¸ì¸</button>
        </div>
    </nav>
</header>

<!-- ë‚ ì§œ ì„ íƒ ì„¹ì…˜ -->
<div class="date-picker-container">
    <label for="diary-date">ë‚ ì§œ ì„ íƒ:</label>
    <input type="date" id="diary-date" name="diary-date">
    <button type="button" class="search-button" id="search-button">
        ê²€ìƒ‰
    </button>
</div>

<!-- ë©”ì¸ ì„¹ì…˜ -->
<main class="main-container">
    <!-- ë‚˜ì˜ ì¼ê¸° ì„¹ì…˜ -->
    <section class="diary-section">
        <h2>
            ğŸ“ ë‚˜ì˜ ì¼ê¸°
        </h2>
        <div class="diary-card">
            <img src="https://via.placeholder.com/180x270" alt="Diary Image" class="diary-image" id="diary-image">
            <div class="diary-content">
                <p id="diary-content">ì—¬ê¸°ì— ì¼ê¸° ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </section>

    <!-- ì¶”ì²œ ë„ì„œ ì„¹ì…˜ -->
    <section class="book-container">
        <h2>
            ğŸ“– ì¶”ì²œ ë„ì„œ
        </h2>
        <div class="book-card">
            <img src="https://via.placeholder.com/180x270" alt="Book Image" class="book-image" id="book-image">
            <div class="book-info">
                <h3 id="book-title">ì±… ì œëª©</h3>
                <p id="book-author">ì €ì: ì €ìëª…</p>
                <p id="book-summary">ì¤„ê±°ë¦¬: ì—¬ê¸°ì— ì±… ì¤„ê±°ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </section>

</main>

<script>
    document.getElementById("search-button").addEventListener("click", function () {
        const selectedDate = document.getElementById("diary-date").value;

        // ë‚ ì§œ ì„ íƒ ì—¬ë¶€ ì²´í¬
        if (!selectedDate) {
            alert("ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        // ì„œë²„ì—ì„œ ì¼ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°
        fetch(`/my_library/api?date=${selectedDate}`)
            .then(response => response.json())
            .then(data => {
                const diaryImageElement = document.getElementById("diary-image");
                const diaryContentDiv = document.getElementById("diary-content");
                const bookImageElement = document.getElementById("book-image");
                const bookTitleElement = document.getElementById("book-title");
                const bookAuthorElement = document.getElementById("book-author");
                const bookSummaryElement = document.getElementById("book-summary");

                // ê¸°ì¡´ ì¼ê¸° ë° ë„ì„œ ì •ë³´ ì´ˆê¸°í™”
                diaryContentDiv.innerHTML = "";

                // ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ í™•ì¸
                if (!Array.isArray(data) || data.length === 0) {
                    diaryContentDiv.innerHTML = "<p>ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                    diaryImageElement.src = "https://via.placeholder.com/120x180"; // ê¸°ë³¸ ì´ë¯¸ì§€ ì„¤ì •
                    bookImageElement.src = "https://via.placeholder.com/180x270"; // ê¸°ë³¸ ë„ì„œ ì´ë¯¸ì§€ ì„¤ì •
                    bookTitleElement.textContent = "ì±… ì œëª©";
                    bookAuthorElement.textContent = "ì €ì: ì €ìëª…";
                    bookSummaryElement.textContent = "ì¤„ê±°ë¦¬: ì—¬ê¸°ì— ì±… ì¤„ê±°ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
                    return;
                }

                // ì²« ë²ˆì§¸ ì¼ê¸°ë§Œ í‘œì‹œ
                const diary = data[0];
                diaryImageElement.src = diary.imageUrl || "https://via.placeholder.com/120x180"; // ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
                diaryContentDiv.textContent = diary.content || "ë‚´ìš© ì—†ìŒ"; // ì¼ê¸° ë‚´ìš© ì—…ë°ì´íŠ¸

                // ì¶”ì²œ ë„ì„œ ì •ë³´ ì—…ë°ì´íŠ¸
                if (diary.book) {
                    bookImageElement.src = diary.book.bookImage || "https://via.placeholder.com/180x270";
                    bookTitleElement.textContent = diary.book.title || "ì œëª© ì—†ìŒ";
                    bookAuthorElement.textContent = `ì €ì: ${diary.book.author || "ì €ì ì •ë³´ ì—†ìŒ"}`;
                    bookSummaryElement.textContent = `ì¤„ê±°ë¦¬: ${diary.book.summary || "ì¤„ê±°ë¦¬ ì •ë³´ ì—†ìŒ"}`;

                    // ì±… ìƒì„¸ ë§í¬ ì¶”ê°€
                    const existingLink = document.querySelector(".book-info a");
                    if (existingLink) {
                        existingLink.remove();
                    }
                    if (diary.book.bookLink) {
                        const bookLink = document.createElement("a");
                        bookLink.href = diary.book.bookLink;
                        bookLink.textContent = "ì±… ìƒì„¸ ë³´ê¸°";
                        bookLink.target = "_blank";
                        document.querySelector(".book-info").appendChild(bookLink);
                    }
                } else {
                    // ì¶”ì²œ ë„ì„œê°€ ì—†ì„ ë•Œ ê¸°ë³¸ê°’ í‘œì‹œ
                    bookImageElement.src = "https://via.placeholder.com/180x270";
                    bookTitleElement.textContent = "ì±… ì œëª©";
                    bookAuthorElement.textContent = "ì €ì: ì €ìëª…";
                    bookSummaryElement.textContent = "ì¤„ê±°ë¦¬: ì—¬ê¸°ì— ì±… ì¤„ê±°ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
                }
            })
            .catch(error => {
                console.error("Error fetching diary:", error);
                const diaryImageElement = document.getElementById("diary-image");
                const diaryContentDiv = document.getElementById("diary-content");
                const bookImageElement = document.getElementById("book-image");
                const bookTitleElement = document.getElementById("book-title");
                const bookAuthorElement = document.getElementById("book-author");
                const bookSummaryElement = document.getElementById("book-summary");

                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ì„¤ì •
                diaryImageElement.src = "https://via.placeholder.com/120x180";
                diaryContentDiv.innerHTML = "<p>ì¼ê¸°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
                bookImageElement.src = "https://via.placeholder.com/180x270";
                bookTitleElement.textContent = "ì±… ì œëª©";
                bookAuthorElement.textContent = "ì €ì: ì €ìëª…";
                bookSummaryElement.textContent = "ì¤„ê±°ë¦¬: ì—¬ê¸°ì— ì±… ì¤„ê±°ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
            });
    });
</script>
</body>
</html>

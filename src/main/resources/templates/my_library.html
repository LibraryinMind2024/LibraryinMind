<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ë„ì„œí•¨</title>
    <link rel="stylesheet" href="css/my_library.css">
    <link rel="stylesheet" href="https://webfontworld.github.io/NanumSquare/NanumSquare.css">
    <!-- Font Awesome ì•„ì´ì½˜ ì‚¬ìš© -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<!-- í—¤ë” ì„¹ì…˜ -->
<header>
    <img src="image/notebook_icon.png" alt="Notebook Icon">
    <a href="main"><h1>ì¼ê¸° ì† ë„ì„œê´€</h1></a>
    <nav>
        <ul>
            <li><a href="recommend">ë„ì„œ ì¶”ì²œ</a></li>
            <li><a href="my_library">ë„ì„œí•¨</a></li>
            <li><a href="mypage">ë‚´ ì •ë³´</a></li>
        </ul>
        <p th:text="'name: ' + ${name} "></p>
        <p th:text="'username: ' + ${username} "></p>

        <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í‘œì‹œ -->
        <div th:if="${username != null}">
            <!-- ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ 'ë¡œê·¸ì•„ì›ƒ' ë²„íŠ¼ -->
            <a href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
        <div th:if="${username == null}">
            <!-- ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ 'ë¡œê·¸ì¸' ë²„íŠ¼ -->
            <button type="button" class="login-button" onClick="location.href='/login'">ë¡œê·¸ì¸</button>
        </div>

    </nav>
</header>

<!-- ë‚ ì§œ ì„ íƒ ì„¹ì…˜ -->
<div class="date-picker-container">
    <label for="diary-date">ë‚ ì§œ ì„ íƒ:</label>
    <input type="date" id="diary-date" name="diary-date">
    <button type="button" class="search-button" id="search-button">
        ê²€ìƒ‰
    </button>
</div>

<!--&lt;!&ndash; ì¼ê¸° ê²°ê³¼ ì¶œë ¥ ì˜ì—­ &ndash;&gt;-->
<!--<div id="diary-result"></div>-->

<!-- ë©”ì¸ ì„¹ì…˜ -->
<main class="main-container">
    <!-- ë‚˜ì˜ ì¼ê¸° ì„¹ì…˜ -->
    <section class="diary-section">
        <h2>
            ğŸ“ ë‚˜ì˜ ì¼ê¸°
        </h2>
        <div class="diary-content" id="diary-content">
            ì—¬ê¸°ì— ì¼ê¸° ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </section>

    <!-- ì¶”ì²œ ë„ì„œ ì„¹ì…˜ -->
    <section class="book-container">
        <h2>
            ğŸ“– ì¶”ì²œ ë„ì„œ
        </h2>
        <div class="book-card">
            <img src="https://via.placeholder.com/120x180" alt="Book Image" class="book-image" id="book-image">
            <div class="book-info">
                <h3 id="book-title">ì±… ì œëª©</h3>
                <p id="book-author">ì €ì: ì €ìëª…</p>
                <p id="book-publisher">ì¶œíŒì‚¬: ì¶œíŒì‚¬ëª…</p>
                <p id="book-summary">ì¤„ê±°ë¦¬: ì—¬ê¸°ì— ì±… ì¤„ê±°ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </section>

</main>



<script>
    document.getElementById("search-button").addEventListener("click", function () {
        const selectedDate = document.getElementById("diary-date").value;

        // ë‚ ì§œ ì„ íƒ ì—¬ë¶€ ì²´í¬
        if (!selectedDate) {
            alert("ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        // ì„œë²„ì—ì„œ ì¼ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°
        fetch(`/my_library/api?date=${selectedDate}`)
            .then(response => response.json())
            .then(data => {
                const diaryContentDiv = document.getElementById("diary-content");
                const bookSectionDiv = document.querySelector(".book-container");

                diaryContentDiv.innerHTML = ""; // ê¸°ì¡´ ë‹¤ì´ì–´ë¦¬ ë‚´ìš© ì´ˆê¸°í™”
                bookSectionDiv.innerHTML = ""; // ê¸°ì¡´ ì¶”ì²œ ë„ì„œ ì´ˆê¸°í™”

                // ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ í™•ì¸
                if (!Array.isArray(data)) {
                    diaryContentDiv.innerHTML = "<p>ì¼ê¸° ë°ì´í„° í˜•ì‹ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.</p>";
                    return;
                }

                // ë°ì´í„°ê°€ ì—†ì„ ë•Œ ì²˜ë¦¬
                if (data.length === 0) {
                    diaryContentDiv.innerHTML = "<p>ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                    return;
                }

                // ì²« ë²ˆì§¸ ì¼ê¸°ë§Œ í‘œì‹œ
                const diary = data[0]; // ì²« ë²ˆì§¸ ë°ì´í„° ì‚¬ìš©
                const contentElement = document.createElement("p");
                contentElement.textContent = diary.content; // ì¼ê¸° ë‚´ìš©
                diaryContentDiv.appendChild(contentElement);

                if (diary.imageUrl) {
                    const diaryImageElement = document.createElement("img");
                    diaryImageElement.src = diary.imageUrl;
                    diaryImageElement.alt = "Diary Image";
                    diaryImageElement.style.maxWidth = "300px";
                    diaryImageElement.style.marginTop = "10px";
                    diaryContentDiv.appendChild(diaryImageElement);
                }

                // ì±… ì •ë³´ ì„¹ì…˜
                if (diary.book) {
                    const bookCard = document.createElement("div");
                    bookCard.classList.add("book-card");

                    const bookImage = document.createElement("img");
                    bookImage.src = diary.book.bookImage || "https://via.placeholder.com/120x180"; // ì´ë¯¸ì§€ ì—†ì„ ë•Œ ê¸°ë³¸ ì´ë¯¸ì§€
                    bookImage.alt = "Book Image";
                    bookImage.classList.add("book-image");
                    bookCard.appendChild(bookImage);

                    const bookInfo = document.createElement("div");
                    bookInfo.classList.add("book-info");

                    const bookTitle = document.createElement("h3");
                    bookTitle.textContent = diary.book.title || "ì œëª© ì—†ìŒ";
                    bookInfo.appendChild(bookTitle);

                    const bookAuthor = document.createElement("p");
                    bookAuthor.textContent = `ì €ì: ${diary.book.author || "ì €ì ì •ë³´ ì—†ìŒ"}`;
                    bookInfo.appendChild(bookAuthor);

                    const bookPublisher = document.createElement("p");
                    bookPublisher.textContent = `ì¶œíŒì‚¬: ${diary.book.publisher || "ì¶œíŒì‚¬ ì •ë³´ ì—†ìŒ"}`;
                    bookInfo.appendChild(bookPublisher);

                    const bookSummary = document.createElement("p");
                    bookSummary.textContent = `ì¤„ê±°ë¦¬: ${diary.book.summary || "ì¤„ê±°ë¦¬ ì •ë³´ ì—†ìŒ"}`;
                    bookInfo.appendChild(bookSummary);

                    if (diary.book.bookLink) {
                        const bookLink = document.createElement("a");
                        bookLink.href = diary.book.bookLink;
                        bookLink.textContent = "ì±… ìƒì„¸ ë³´ê¸°";
                        bookLink.target = "_blank";
                        bookInfo.appendChild(bookLink);
                    }

                    bookCard.appendChild(bookInfo);
                    bookSectionDiv.appendChild(bookCard);
                } else {
                    bookSectionDiv.innerHTML = "<p>ì¶”ì²œ ë„ì„œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                }
            })
            .catch(error => {
                console.error("Error fetching diary:", error);
                const diaryContentDiv = document.getElementById("diary-content");
                const bookSectionDiv = document.querySelector(".book-container");
                diaryContentDiv.innerHTML = "<p>ì¼ê¸°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
                bookSectionDiv.innerHTML = "<p>ë„ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
            });
    });

</script>

</body>
</html>